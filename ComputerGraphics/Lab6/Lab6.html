
<!DOCTYPE html>
<html>
    <head>
		<title>实验六</title>
        <meta charset="utf-8">
		<style type="text/css">
			.atitle{
				text-align: left;
				font-weight: 1000;
			}
		</style>
        <script id="vertex-Pshader" type="x-shader/x-vertex">
        	attribute vec4 vPosition;
        	attribute vec4 vColor;
        	varying vec4 fColor;
        	
        	uniform mat4 modelViewMatrix;
        	uniform mat4 projectionMatrix;
        	uniform vec3 zoom;
        	
        	// add Phong Shading(平面法线+面片着色)
        	attribute vec4 vNormal;
        	
        	uniform mat3 normalMatrix;
        	varying vec3 normalInterp;
        	varying vec4 vertexPos;
        	
        	void main(){
        		mat4 Zoom = mat4(1.0+zoom[0], 0.0, 0.0, 0.0,
        						 0.0, 1.0+zoom[1], 0.0, 0.0,
        						 0.0, 0.0, 1.0+zoom[2], 0.0,
        						 0.0, 0.0, 0.0, 1.0);
        		
        		vertexPos = modelViewMatrix * vPosition;
        		normalInterp = normalize(normalMatrix * vNormal.xyz);
        		gl_Position = projectionMatrix * modelViewMatrix * vertexPos;
        		
        		// gl_Position = projectionMatrix * modelViewMatrix * vPosition;
        		gl_Position = Zoom * gl_Position;
        		fColor = vColor;
        	}
        </script>
        <script id="fragment-Pshader" type="x-shader/x-fragment">
			precision mediump float;
			
			varying vec4 fColor;
			
			// add Phong Shading(平面法线+面片着色)
			varying vec3 normalInterp;
			varying vec4 vertexPos;
			
			uniform vec4 lightPosition;
			uniform float shininess;
			
			uniform float materialKa, materialKd, materialKs;
			
			uniform vec4 ambientProduct;
			uniform vec4 diffuseProduct;
			uniform vec4 specularProduct;
			
			void main(){
				vec3 N = normalize(normalInterp);
				vec3 L;
				if(lightPosition.w == 0.0)
					L = normalize(lightPosition.xyz);
				else
					L = normalize(lightPosition.xyz - vertexPos.xyz);
			
				vec4 ambient = ambientProduct;
			
				float Kd = max(dot(L, N), 0.0);
				vec4 diffuse = Kd * diffuseProduct;
			
				float Ks = 0.0;
			
				if(Kd > 0.0){
					vec3 R = reflect(-L, N);
					vec3 V = normalize(-vertexPos.xyz);
					float speculaAngle = max(dot(R, V), 0.0);
					Ks = pow(speculaAngle, shininess);
				}
				vec4 specular = Ks * specularProduct;
			
				gl_FragColor = materialKa * ambient + materialKd * diffuse + materialKs * specular;
			
				// gl_FragColor = fColor;
			}
		</script>
		<script id="vertex-Gshader" type="x-shader/x-vertex">
			attribute vec4 vPosition;
			attribute vec4 vNormal;
			
			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;
			uniform mat3 normalMatrix;
			uniform vec3 zoom;
			
			uniform vec4 lightPosition;
			
			uniform float shininess;
			
			// material
			uniform vec4 ambientProduct;
			uniform vec4 diffuseProduct;
			uniform vec4 specularProduct;
			
			varying vec3 normalInterp;
			varying vec4 fColor;
			
			void main(){
				mat4 Zoom = mat4(1.0+zoom[0], 0.0, 0.0, 0.0,
								 0.0, 1.0+zoom[1], 0.0, 0.0,
								 0.0, 0.0, 1.0+zoom[2], 0.0,
								 0.0, 0.0, 0.0, 1.0);
				vec4 pos = modelViewMatrix * vPosition;
				normalInterp = normalize(normalMatrix * vNormal.xyz);
			
				gl_Position = projectionMatrix * pos;
			
				vec4 ambient = ambientProduct;
			
				vec3 N = normalize(normalInterp);
				vec3 L;
			
				if(lightPosition.w == 0.0){
					L = normalize(lightPosition.xyz);
				}else{
					L = normalize(lightPosition.xyz - pos.xyz);
				}
			
				float Kd = max(dot(L, N), 0.0);
				vec4 diffuse = Kd * diffuseProduct;
			
				float Ks = 0.0;
				if(Kd > 0.0){
					vec3 R = reflect(-L, N);
					vec3 E = -normalize(pos.xyz);
					float specAngle = max(dot(R, E), 0.0);
					Ks = pow(specAngle, shininess);
				}
				vec4 specular = Ks * specularProduct;
			
				fColor = ambient + diffuse + specular;
				fColor.a = 1.0;
				gl_Position = Zoom * gl_Position;
			}
		</script>
        <script id="fragment-Gshader" type="x-shader/x-fragment">
        	precision mediump float;
        
        	varying vec4 fColor;
        
        	void main()
        	{
                gl_FragColor = fColor;
        	}
        </script>
        <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="../webgl-utils.js"></script>
        <script type="text/javascript" src="../initShaders.js"></script>
        <script type="text/javascript" src="../gl-matrix-min.js"></script>
        <script type="text/javascript" src="../objloader.js"></script>
        <script type="text/javascript" src="lab6.js"></script>
    </head>
    <body>
        <div>
            <canvas id="gl-canvas" width="880" height="880" style="margin: 10px; float: left;">
                你的浏览器不支持HTML5 Canvas元素
            </canvas>
        </div>
			
			<div class="atitle">模型投影方式</div>
            <label>选择投影方式</label>
            <input type="radio" id="ortho" name="projtype" value="1" checked><label>正交投影</label>
            &nbsp;
            <input type="radio" id="persp" name="projtype" value="2"><label>透视投影</label>&nbsp;<label id="projtyperes"></label>
			<br />
            <label>选择绘制方式</label>
            <input type="radio" id="wire" name="drawtype" value="1" checked><label>线框模式</label>
            &nbsp;
            <input type="radio" id="solid" name="drawtype" value="2" ><label>实体模式</label>
			<br />
            模型颜色：<input type="color" id="objcolor" name="objcolor" value="#ff0000">
			<br />
            <label>改变对象位置</label><input type="radio" id="objpos" name="posgrp" value="1" checked><label>物体位置</label>
            &nbsp;
            <input type="radio" id="campos" name="posgrp" value="2"><label>相机位置</label>&nbsp;<label
                id="projtyperes"></label>
            <br />
			<hr />
			
			<div class="atitle">绕x、y、z轴平移</div>
            <label>x pos</label><input type="range" id="xpos" name="xpos" min="-5.0" max="5.0" step="0.01"><br />
            <label>y pos</label><input type="range" id="ypos" name="ypos" min="-5.0" max="5.0" step="0.01"><br />
            <label>z pos</label><input type="range" id="zpos" name="zpos" min="-5.0" max="5.0" step="0.01"><br />
			<hr />
            
			<div class="atitle">绕x、y、z轴旋转</div>
			<label>x rot</label><input type="range" id="xrot" name="xrot" min="-1" max="1" step="0.001"><br />
			<label>y rot</label><input type="range" id="yrot" name="yrot" min="-1" max="1" step="0.001"><br />
			<label>z rot</label><input type="range" id="zrot" name="zrot" min="-1" max="1" step="0.001"><br />
			<hr />
			
			<div class="atitle">光照模拟</div>
			<label>光照模拟形式：</label>
			<select id="select_shader_id">
				<option value="1" selected="selected">Phong Shading</option>
				<option value="2">Gouraud Shading</option>
			</select><br />
			<hr />
			
			<div class="atitle">材质参数</div>
			<label>环境反射系数(ka)：</label>
			<input type='range' id='slider-ka' name='ka' min='0' max='1' step='0.01'>
			<label id="slider-ka-value" width='30px'>1.0</label>
			<br />
			<label>漫反射系数(kd)：</label>
			<input type='range' id='slider-kd' name='kd' min='0' max='1' step='0.01'>
			<label id="slider-kd-value" width='30px'>1.0</label>
			<br />
			<label>镜面反射系数(ks)：</label>
			<input type='range' id='slider-ks' name='ka' min='0' max='1' step='0.01'>
			<label id="slider-ks-value" width='30px'>1.0</label>
			<br />
			<label>高光系数：</label>
			<input type='range' id='slider-sh' name='sh' min='1' max='500' step='1'>
			<label id="slider-sh-value" width='30px'>1.0</label>
			<br />
			<label>环境光颜色：</label>
			<input type='color' id='ka-color' name='kacolor' value='#ff0000'><br />
			<label>漫反射光颜色：</label>
			<input type='color' id='kd-color' name='kdcolor' value='#ffffff'><br />
			<label>镜面反射光颜色：</label>
			<input type='color' id='ks-color' name='kscolor' value='#ffffff'><br />
			<label>背景幕布颜色：</label>
			<input type='color' id='bk-color' name='bkcolor' value='#55ffff'><br />
			<hr />
			
			<div class="atitle">光源参数</div>
			光源位置<br />
			<label>X：</label>
			<input type='range' id='slider-x' name='xvalue' min='-10.0' max='10.0' step='0.1'>
			<label id="slider-x-value" width='30px'>1</label>
			<br />
			<label>Y：</label>
			<input type='range' id='slider-y' name='yvalue' min='-10.0' max='10.0' step='0.1'>
			<label id="slider-y-value" width='30px'>1</label>
			<br />
			<label>Z：</label>
			<input type='range' id='slider-z' name='zvalue' min='-10.0' max='10.0' step='0.1'>
			<label id="slider-z-value" width='30px'>1</label>
			<br />
			
			光源颜色<br />
			<label>环境光颜色：</label>
			<input type='color' id='lt-ambient-color' name='ltamcolor' value='#ffffff'><br />
			<label>漫反射光颜色：</label>
			<input type='color' id='lt-diffuse-color' name='ltdfcolor' value='#ffffff'><br />
			<label>镜面反射光颜色：</label>
			<input type='color' id='lt-specular-color' name='ltspcolor' value='#ffffff'><br />
    </body>
</html>